#!/usr/bin/env bash

HOST="127.0.0.1"
PORT="8080"

COLOR_DEFAULT="\e[39m"
COLOR_RESET="\033[0m"
COLOR_BASED="\e[39m"
COLOR_DANGER="\e[91m"
COLOR_WARNING="\e[93m"
COLOR_SUCCESS="\e[92m"
COLOR_SKY="\e[34m"

response() {

    PROTOCOL=`curl -I ${1} 2> /dev/null | sed -n 1p | awk '{printf $1}'`
    STATUS=`curl -I ${1} 2> /dev/null | sed -n 1p | awk '{printf $2}'`
    SERVER=`curl -I ${1} 2> /dev/null | sed -n 3p | awk '{print $2" "$3}'`
    CONTENT=`curl -I ${1} 2> /dev/null | grep Content-Type: | awk '{printf $2" "$3}'`

    echo -e "
  ╭─ LAMP CHECK ───────────────────────────────────╮"
    echo -e "  │                                                │"
 
    echo -e "  │  Request URL: http://${HOST}:${PORT}            │"
    echo -e "  │                                                │"
    printf "  │  %-11s  %-8s  %-21s  │\n" "PATH" "Header" "Value"
    printf "  │  %-11s  %-8s  %-20s  │\n" "───────────" "────────" "─────────────────────"
    echo -e "  │                                                │"

    printf "  │  %-11s  %-8s  %-21s  │\n" ${2} "Protocol" ${PROTOCOL}

    if [ ${STATUS} == "200" ]; then
        printf "  │  %-10s   %-8s  ${COLOR_SUCCESS}%-23s${COLOR_DEFAULT}│\n" "" "Status" "${STATUS} OK"
    elif [ ${STATUS} == "301" ]; then
        printf "  │  %-10s   %-8s  ${COLOR_SUCCESS}%-23s${COLOR_DEFAULT}│\n" "" "Status" "${STATUS} Moved Permanently"
    elif [ ${STATUS} == "403" ]; then
        printf "  │  %-10s   %-8s  ${COLOR_DANGER}%-23s${COLOR_DEFAULT}│\n" "" "Status" "${STATUS} Forbidden"
    fi

    echo -e "  │               Server    ${SERVER}   │"
    echo -e "  │                                                │"
    echo -e "  ╰────────────────────────────────────────────────╯\n"
}

response "${HOST}:${PORT}" "/"
response "${HOST}:${PORT}/phpmyadmin" "/phpmyadmin"